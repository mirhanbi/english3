<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ì–´ ì§€ë¬¸ ì•”ê¸° ê²Œì„! ğŸ°ğŸš‚ğŸ“š</title> <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #ffe6f2; /* ì—°í•œ í•‘í¬ìƒ‰ ë°°ê²½ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-image: url('https://www.transparenttextures.com/patterns/fabric-1.png'); /* ê·€ì—¬ìš´ ë°°ê²½ íŒ¨í„´ */
        }
        .container {
            background-color: #ffffff;
            border-radius: 25px;
            padding: 30px 40px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 800px;
            width: 100%;
            border: 5px solid #ffccdd; /* í…Œë‘ë¦¬ */
            position: relative;
            overflow: hidden;
        }
        .container::before {
            content: 'ğŸ°ğŸ’–'; /* ì´ëª¨ì§€ ë³€ê²½ */
            position: absolute;
            top: -15px;
            left: -15px;
            font-size: 60px;
            opacity: 0.2;
            transform: rotate(-20deg);
        }
        .container::after {
            content: 'ğŸ“šâœ¨'; /* ì´ëª¨ì§€ ë³€ê²½ */
            position: absolute;
            bottom: -15px;
            right: -15px;
            font-size: 60px;
            opacity: 0.2;
            transform: rotate(20deg);
        }
        h1 {
            color: #ff69b4; /* í•«í•‘í¬ */
            font-size: 2.8em;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #8a2be2; /* ë³´ë¼ìƒ‰ */
            font-size: 1.8em;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .korean-sentence {
            font-size: 1.5em;
            color: #4b0082; /* ì§„í•œ ë³´ë¼ìƒ‰ */
            margin-bottom: 30px;
            background-color: #f0e6fa;
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px dashed #dda0dd;
        }
        .english-sentence-display {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 30px;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            text-align: left;
            line-height: 1.8;
            word-wrap: break-word; /* ê¸´ ë‹¨ì–´ ì¤„ ë°”ê¿ˆ */
        }
        .blank-input {
            width: 120px; /* ë¸”ë­í¬ ì…ë ¥ì°½ ê¸°ë³¸ ë„ˆë¹„ */
            padding: 8px 10px;
            font-size: 1em;
            border: 2px solid #ff99cc;
            border-radius: 8px;
            box-sizing: border-box;
            text-align: center;
            margin: 0 3px;
            vertical-align: middle; /* í…ìŠ¤íŠ¸ì™€ ë†’ì´ ë§ì¶”ê¸° */
            transition: all 0.3s ease;
        }
        .blank-input:focus {
            border-color: #ff3399;
            box-shadow: 0 0 8px rgba(255, 51, 153, 0.3);
            outline: none;
        }
        .full-sentence-input { /* ë¼ìš´ë“œ 3, 4 ì „ì²´ ë¬¸ì¥ ì…ë ¥ìš© */
            width: calc(100% - 40px);
            padding: 15px;
            font-size: 1.3em;
            border: 3px solid #ff99cc;
            border-radius: 12px;
            box-sizing: border-box;
            margin-top: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .full-sentence-input:focus {
            border-color: #ff3399;
            box-shadow: 0 0 10px rgba(255, 51, 153, 0.3);
            outline: none;
        }
        .feedback {
            font-size: 1.4em;
            font-weight: bold;
            margin-top: 20px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            padding: 5px;
        }
        .feedback.correct {
            color: #008000; /* ì´ˆë¡ìƒ‰ */
            background-color: #e6ffe6;
            border: 2px solid #00cc00;
        }
        .feedback.wrong {
            color: #ff0000; /* ë¹¨ê°„ìƒ‰ */
            background-color: #ffe6e6;
            border: 2px solid #ff6666;
        }
        .button-group {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        button {
            background-color: #ff69b4; /* í•«í•‘í¬ */
            color: white;
            padding: 15px 30px;
            font-size: 1.2em; /* ë²„íŠ¼ ê¸€ì í¬ê¸° ì¡°ì • */
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        button:hover {
            background-color: #ff3399;
            transform: translateY(-3px);
        }
        button:active {
            transform: translateY(0);
        }
        .score-display {
            font-size: 2em;
            font-weight: bold;
            color: #8a2be2;
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
        .answer-reveal {
            font-size: 1.2em;
            color: #6a5acd; /* ìŠ¬ë ˆì´íŠ¸ ë¸”ë£¨ */
            margin-top: 10px;
            background-color: #f5f0ff;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #d8bfd8;
            text-align: left;
        }
        .round-info {
            font-size: 1.2em;
            color: #ff69b4;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .correct-word {
            color: #008000;
            font-weight: bold;
        }
        .wrong-word {
            color: #ff0000;
            font-weight: bold;
            text-decoration: line-through;
        }
        .missing-word { /* ì‚¬ìš©ìê°€ ë¹¼ë¨¹ì€ ë‹¨ì–´ */
            color: #ff8c00; /* ì£¼í™©ìƒ‰ */
            font-weight: bold;
            background-color: #fffacd; /* ì—°í•œ ë…¸ë‘ */
            padding: 2px 4px;
            border-radius: 3px;
        }
        .extra-word { /* ì‚¬ìš©ìê°€ ì¶”ê°€í•œ ë‹¨ì–´ */
            color: #4b0082; /* ì§„í•œ ë³´ë¼ìƒ‰ */
            background-color: #e6e6fa; /* ì—°í•œ ë³´ë¼ */
            padding: 2px 4px;
            border-radius: 3px;
        }
        .navigation-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap; /* ë²„íŠ¼ì´ ë§ì•„ì§ˆ ê²½ìš° ì¤„ë°”ê¿ˆ */
        }
        .navigation-buttons button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #9370db; /* ë³´ë¼ìƒ‰ ê³„ì—´ */
        }
        .navigation-buttons button:hover {
            background-color: #6a5acd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’– ì˜ì–´ ì§€ë¬¸ ì•”ê¸° ê²Œì„ ğŸ’–</h1> <div class="score-display">ì´ì : <span id="totalScore">0</span>ì </div>
        <div class="round-info" id="roundInfo"></div>

        <div id="gameScreen">
            <h2 id="questionTitle"></h2>
            <div class="korean-sentence" id="koreanSentence"></div>
            
            <div class="english-sentence-display" id="englishSentenceDisplay">
            </div>

            <input type="text" id="fullSentenceInput" class="full-sentence-input hidden" onkeydown="handleEnter(event)">

            <div class="feedback" id="feedback"></div>
            <div class="answer-reveal hidden" id="correctAnswerReveal">ì •ë‹µ: <span id="revealedAnswer"></span></div>
            <div class="button-group">
                <button onclick="prevQuestion()">ë’¤ë¡œ ê°€ê¸°</button>
                <button onclick="checkAnswer()">í™•ì¸</button>
                <button onclick="nextQuestion()">ë‹¤ìŒ</button>
            </div>
            <div class="navigation-buttons">
                <button onclick="goToRound(1)">ë¼ìš´ë“œ 1</button>
                <button onclick="goToRound(2)">ë¼ìš´ë“œ 2</button>
                <button onclick="goToRound(3)">ë¼ìš´ë“œ 3</button>
                <button onclick="goToRound(4)">ë¼ìš´ë“œ 4</button>
            </div>
        </div>

        <div id="endScreen" class="hidden">
            <h1>ğŸ‰ ê²Œì„ ë! ğŸ‰</h1>
            <h2>ìµœì¢… ì ìˆ˜: <span id="finalScore"></span>ì </h2>
            <p style="font-size: 1.5em; color: #8a2be2;">ì •ë§ ì˜í–ˆì–´ìš”! ë˜ ë„ì „í•´ë´ìš”!</p>
            <button onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        const sentences = [
            // 6ë²ˆ ì§€ë¬¸
            {
                korean: "ì‹ ë””, ì´ë²ˆ ì£¼ë§ì— ë¬´ì—‡ì„ í•  ì˜ˆì •ì´ë‹ˆ?",
                english: "Cindy, what are you going to do this weekend?"
            },
            {
                korean: "ì €ëŠ” ì´ˆì½œë¦¿ ê³µì¥ì— ê°ˆ ê±°ì˜ˆìš”.",
                english: "I'm going to the chocolate factory."
            },
            {
                korean: "ì‹œë‚´ì— ìˆëŠ” ê·¸ê³³ì„ ë§í•˜ëŠ” ê±°ë‹ˆ?",
                english: "You mean the one in the city?"
            },
            {
                korean: "ë§ì•„ìš”. ì €ëŠ” ì´ˆì½œë¦¿ì„ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”. ì •ë§ ê¸°ëŒ€ë¼ìš”.",
                english: "Right. I can make chocolate there. I'm so excited."
            },
            {
                korean: "ê±°ê¸°ì„œ ë§ì€ ì´ˆì½œë¦¿ ë§›ë„ ë³¼ ìˆ˜ ìˆì–´ìš”.",
                english: "You can also taste a lot of chocolate there."
            },
            {
                korean: "ì •ë§ìš”? ì •ë§ ë©‹ì§€ê² ë„¤ìš”.",
                english: "Really? That would be wonderful."
            },
            // 7ë²ˆ ì§€ë¬¸
            {
                korean: "ì—¬ë³´ì„¸ìš”. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
                english: "Hello. How can I help you?"
            },
            {
                korean: "ì œ í† ë¼ê°€ ì™¼ìª½ ëˆˆì„ ëœ° ìˆ˜ ì—†ì–´ìš”. ëˆˆì„ ë´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?",
                english: "Hi. My rabbit can't open her left eye. Can you look at her eye?"
            },
            {
                korean: "ë„¤, ë¬¼ë¡ ì´ì£ . ì–¸ì œë¶€í„° ê·¸ë¬ë‚˜ìš”?",
                english: "Of course. When did it start?"
            },
            {
                korean: "ì˜¤ëŠ˜ ì•„ì¹¨ì— ì‹œì‘ëì–´ìš”. ê±±ì •ë¼ìš”.",
                english: "It started this morning. I'm so worried."
            },
            {
                korean: "ì•Œê² ìŠµë‹ˆë‹¤. ì œê°€ í† ë¼ì˜ ëˆˆì„ í™•ì¸í•˜ê³  ì˜¬ë°”ë¥¸ ì•½ì„ ë“œë¦´ê²Œìš”.",
                english: "Okay, I'll check your rabbit's eye and give her the right medicine."
            },
            {
                korean: "ê³ ë§ˆì›Œìš”.",
                english: "Thank you."
            },
            // 8ë²ˆ ì§€ë¬¸
            {
                korean: "ì—„ë§ˆ, ìš°ë¦¬ ê¸°ì°¨ëŠ” ì–¸ì œ ì˜¤ë‚˜ìš”?",
                english: "Mom, when is our train coming?"
            },
            {
                korean: "ì–˜ì•¼. ìš°ë¦¬ëŠ” ê¸°ë‹¤ë ¤ì•¼ í•´. ê¸°ì°¨ëŠ” ê³§ ì˜¬ ê±°ì•¼.",
                english: "Sweetheart. We have to wait. The train will come soon."
            },
            {
                korean: "ì •ë§ìš”?",
                english: "Really?"
            },
            {
                korean: "í™”ë©´ì—ëŠ” ëª‡ ë¶„ í›„ì— ì˜¬ ê²ƒì´ë¼ê³  ë‚˜ì™€ ìˆì–´.",
                english: "The screen above says that it'll be a few minutes late."
            },
            {
                korean: "ì•Œê² ì–´ìš”. í•˜ì§€ë§Œ ì¢€ í”¼ê³¤í•´ìš”.",
                english: "I see. But I'm getting a little tired."
            },
            {
                korean: "ì•Œê² ì–´. ì˜¤, ì´ì œ ê¸°ì°¨ê°€ ì˜¤ëŠ”êµ¬ë‚˜.",
                english: "I know. Oh! I see it coming now."
            },
            {
                korean: "ì •ë§ ë“œë””ì–´ ê¸°ì°¨ê°€ ì™€ì„œ ê¸°ë»ìš”.",
                english: "I'm glad it's finally here."
            },
            // 9ë²ˆ ì§€ë¬¸
            {
                korean: "ì•ˆë…•, ë¸Œë¼ì´ì–¸. ì–´ë”” ê°€ë‹ˆ?",
                english: "Hi, Brian. Where are you going?"
            },
            {
                korean: "ì•ˆë…•, ì œì¸. ì‹œë¦½ ë„ì„œê´€ì— ê°€ê³  ìˆì–´.",
                english: "Hi, Jane. I'm going to the town library."
            },
            {
                korean: "ì‹œë¦½ ë„ì„œê´€ì€ ì˜¤ëŠ˜ ë¬¸ì„ ì—´ì§€ ì•Šì•„. ë§¤ì£¼ ì›”ìš”ì¼ì€ íœ´ê´€ì´ì•¼.",
                english: "The town library is not open today. It's closed every Monday."
            },
            {
                korean: "ì˜¤, ì´ëŸ°. ì˜¤ëŠ˜ ì´ ì±…ë“¤ì„ ë°˜ë‚©í•´ì•¼ í•´.",
                english: "Oh, no. I have to return these books today."
            },
            {
                korean: "ê±±ì • ë§ˆ. ë°˜ë‚©í•¨ì— ë„£ì„ ìˆ˜ ìˆì–´. ë„ì„œê´€ ì•ì— ìˆì–´.",
                english: "Don't worry. You can put them in the return box. It's in front of the library."
            },
            {
                korean: "ì•Œë ¤ì¤˜ì„œ ê³ ë§ˆì›Œ.",
                english: "Thanks for telling me."
            }
        ];

        let currentSentenceIndex = 0;
        let totalScore = 0;
        let currentRound = 1; // 1: ë¸”ë­í¬ 3ê°œ, 2: ë¸”ë­í¬ ë” ë§ì´, 3: í†µì§¸ë¡œ, 4: í†µë¬¸ì¥ ì“°ê¸° (ë¸”ë­í¬ ì—†ìŒ)
        const maxRounds = 4;
        const totalQuestionsPerRound = sentences.length;

        const totalScoreSpan = document.getElementById('totalScore');
        const roundInfoDiv = document.getElementById('roundInfo');
        const koreanSentenceDiv = document.getElementById('koreanSentence');
        const englishSentenceDisplay = document.getElementById('englishSentenceDisplay'); // ë¬¸ì¥ í‘œì‹œ ì˜ì—­
        const fullSentenceInput = document.getElementById('fullSentenceInput'); // ë¼ìš´ë“œ 3, 4 ì „ìš© ì…ë ¥
        const feedbackDiv = document.getElementById('feedback');
        const gameScreen = document.getElementById('gameScreen');
        const endScreen = document.getElementById('endScreen');
        const finalScoreSpan = document.getElementById('finalScore');
        const questionTitle = document.getElementById('questionTitle');
        const correctAnswerReveal = document.getElementById('correctAnswerReveal');
        const revealedAnswerSpan = document.getElementById('revealedAnswer');

        let blankIndices = []; // ë¸”ë­í¬ ë‹¨ì–´ì˜ ì¸ë±ìŠ¤ë¥¼ ì €ì¥í•  ë°°ì—´

        // ë¬´ì‘ìœ„ë¡œ ë¸”ë­í¬ë¥¼ ì„ íƒí•˜ëŠ” í•¨ìˆ˜ (ë” ê²¬ê³ í•˜ê²Œ ìˆ˜ì •)
        function getWordsToBlank(words, numBlanks) {
            const indices = new Set();
            // êµ¬ë‘ì ë§Œ ìˆëŠ” ë‹¨ì–´ë¥¼ ì œì™¸í•˜ê³ , ê¸¸ì´ê°€ 2 ì´ˆê³¼ì¸ ë‹¨ì–´ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ë¸”ë­í¬ ëŒ€ìƒìœ¼ë¡œ ì„ ì •
            const eligibleIndices = words.map((word, idx) => ({ word: word.replace(/[.,!?;:\"'/]$/, ''), idx }))
                                            .filter(item => item.word.length > 2)
                                            .map(item => item.idx);
            
            // ê°€ëŠ¥í•œ ë¸”ë­í¬í•  ë‹¨ì–´ê°€ numBlanksë³´ë‹¤ ì ìœ¼ë©´, êµ¬ë‘ì ë§Œ ìˆëŠ” ë‹¨ì–´ë¥¼ ì œì™¸í•œ ëª¨ë“  ë‹¨ì–´ì—ì„œ ì„ íƒ
            if (eligibleIndices.length < numBlanks) {
                const allValidWordsIndices = words.map((word, idx) => ({ word: word.replace(/[.,!?;:\"'/]$/, ''), idx }))
                                                    .filter(item => item.word.length > 0) // ì•„ì˜ˆ ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹Œ ë‹¨ì–´
                                                    .map(item => item.idx);

                while (indices.size < numBlanks && indices.size < allValidWordsIndices.length) {
                    const randomIndex = Math.floor(Math.random() * allValidWordsIndices.length);
                    indices.add(allValidWordsIndices[randomIndex]);
                }
            } else { // ì¶©ë¶„í•œ eligibleIndicesê°€ ìˆë‹¤ë©´ ê±°ê¸°ì„œë§Œ ì„ íƒ
                while (indices.size < numBlanks && indices.size < eligibleIndices.length) {
                    const randomIndex = Math.floor(Math.random() * eligibleIndices.length);
                    indices.add(eligibleIndices[randomIndex]);
                }
            }
            return Array.from(indices).sort((a,b) => a - b);
        }


        function displayQuestion() {
            if (currentRound > maxRounds) {
                endGame();
                return;
            }
            
            // ë¼ìš´ë“œ ì •ë³´ ì—…ë°ì´íŠ¸
            const roundNumberDisplay = currentRound > maxRounds ? maxRounds : currentRound; // ìµœëŒ€ ë¼ìš´ë“œ ì´ˆê³¼ ì‹œ maxRoundsë¡œ í‘œì‹œ
            roundInfoDiv.textContent = `ë¼ìš´ë“œ: ${roundNumberDisplay} / ${maxRounds} (ë¬¸ì œ ${currentSentenceIndex + 1} / ${totalQuestionsPerRound})`;

            const currentSentence = sentences[currentSentenceIndex];
            feedbackDiv.className = 'feedback'; // í”¼ë“œë°± ì´ˆê¸°í™”
            feedbackDiv.textContent = '';
            correctAnswerReveal.classList.add('hidden');
            fullSentenceInput.classList.add('hidden'); // ì „ì²´ ë¬¸ì¥ ì…ë ¥ì°½ ìˆ¨ê¸°ê¸°
            englishSentenceDisplay.innerHTML = ''; // ë¬¸ì¥ í‘œì‹œ ì˜ì—­ ì´ˆê¸°í™”

            // ëª¨ë“  ë¼ìš´ë“œì—ì„œ í•œê¸€ ë²ˆì—­ ì œì‹œ
            koreanSentenceDiv.textContent = currentSentence.korean;

            if (currentRound === 3 || currentRound === 4) { // ë¼ìš´ë“œ 3ê³¼ 4ëŠ” í†µë¬¸ì¥ ì…ë ¥
                questionTitle.textContent = currentRound === 3 ? "ë‹¤ìŒ ì˜ì–´ ë¬¸ì¥ì„ í†µì§¸ë¡œ ì¨ë³´ì„¸ìš”." : "ë‹¤ìŒ ì˜ì–´ ë¬¸ì¥ì„ í†µì§¸ë¡œ ì¨ë³´ì„¸ìš”. (ë§ˆì§€ë§‰ ì—°ìŠµ)";
                fullSentenceInput.classList.remove('hidden'); // í†µë¬¸ì¥ ì…ë ¥ì°½ ë³´ì´ê¸°
                fullSentenceInput.value = "";
                fullSentenceInput.disabled = false;
                
                // ë¼ìš´ë“œ 3ì€ placeholderë¡œ íŒíŠ¸ ì œê³µ, ë¼ìš´ë“œ 4ëŠ” placeholder ë¹„ì›€
                fullSentenceInput.placeholder = currentRound === 3 ? currentSentence.english : ""; 
                
                englishSentenceDisplay.style.display = 'none'; // ë¸”ë­í¬ ë¬¸ì¥ í‘œì‹œ ì˜ì—­ ìˆ¨ê¸°ê¸°
                fullSentenceInput.focus(); // í†µë¬¸ì¥ ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
            } else { // ë¼ìš´ë“œ 1, 2ëŠ” ë¸”ë­í¬ ì…ë ¥
                questionTitle.textContent = "ë‹¤ìŒ ì˜ì–´ ë¬¸ì¥ì„ ì™„ì„±í•˜ì„¸ìš”.";
                fullSentenceInput.classList.add('hidden'); // í†µë¬¸ì¥ ì…ë ¥ì°½ ìˆ¨ê¸°ê¸°
                englishSentenceDisplay.style.display = 'block'; // ë¸”ë­í¬ ë¬¸ì¥ í‘œì‹œ ì˜ì—­ ë³´ì´ê¸°

                const words = currentSentence.english.split(' ');
                let numBlanks;

                if (currentRound === 1) { // 3ê°œ ë¸”ë­í¬
                    numBlanks = 3;
                } else if (currentRound === 2) { // ë” ë§ì´ ë¸”ë­í¬ (ì ˆë°˜ ì •ë„)
                    numBlanks = Math.max(1, Math.floor(words.length / 2));
                }
                
                blankIndices = getWordsToBlank(words, numBlanks);

                let displayHtml = '';
                words.forEach((word, index) => {
                    if (blankIndices.includes(index)) {
                        const inputWidth = Math.max(80, word.replace(/[.,!?;:\"'/]$/, '').length * 12); // ë‹¨ì–´ ê¸¸ì´ì— ë”°ë¼ ì…ë ¥ì°½ ë„ˆë¹„ ì¡°ì ˆ (ìµœì†Œ 80px)
                        displayHtml += `<input type="text" class="blank-input" data-index="${index}" style="width: ${inputWidth}px;" onkeydown="handleEnter(event)"> `;
                    } else {
                        displayHtml += `${word} `;
                    }
                });
                englishSentenceDisplay.innerHTML = displayHtml;

                // ì…ë ¥ í•„ë“œ í™œì„±í™” ë° ì²« ë²ˆì§¸ ë¸”ë­í¬ì— í¬ì»¤ìŠ¤
                const firstBlankInput = document.querySelector('.blank-input');
                if (firstBlankInput) {
                    firstBlankInput.focus();
                }
            }
        }

        // ì—”í„° í‚¤ ì²˜ë¦¬
        function handleEnter(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // ê¸°ë³¸ Enter ë™ì‘ ë°©ì§€ (ì˜ˆ: í¼ ì „ì†¡)
                checkAnswer();
            }
        }

        function checkAnswer() {
            let userAnswer;
            let correctAnswer;
            let isCorrect = true;

            const currentSentence = sentences[currentSentenceIndex];
            correctAnswer = currentSentence.english; // ëª¨ë“  ë¼ìš´ë“œì—ì„œ í˜„ì¬ ë¬¸ì¥ì´ ì •ë‹µ

            if (currentRound === 3 || currentRound === 4) { // ë¼ìš´ë“œ 3, 4ëŠ” í†µë¬¸ì¥ ì…ë ¥
                userAnswer = fullSentenceInput.value.trim();
                isCorrect = (userAnswer.toLowerCase() === correctAnswer.toLowerCase());
            } else { // ë¼ìš´ë“œ 1, 2ëŠ” ë¸”ë­í¬ ì…ë ¥
                const inputElements = document.querySelectorAll('.blank-input');
                let userFilledWords = []; // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‹¨ì–´ë“¤ë§Œ ëª¨ìŒ

                // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‹¨ì–´ë“¤ì„ data-indexì— ë§ì¶° ë°°ì—´ì— ì €ì¥
                inputElements.forEach(input => {
                    const index = parseInt(input.dataset.index);
                    userFilledWords[index] = input.value.trim();
                });

                // ì „ì²´ ë¬¸ì¥ì„ ì¬êµ¬ì„±í•˜ì—¬ userAnswer ìƒì„± (ë¹„êµë¥¼ ìœ„í•¨)
                let tempFullUserSentenceWords = [];
                const originalWords = correctAnswer.split(' '); // currentSentence.english ì‚¬ìš©
                originalWords.forEach((word, index) => {
                    if (blankIndices.includes(index)) {
                        tempFullUserSentenceWords.push(userFilledWords[index] || ''); // ì‚¬ìš©ìê°€ ì…ë ¥ ì•ˆ í–ˆìœ¼ë©´ ë¹ˆ ë¬¸ìì—´
                    } else {
                        tempFullUserSentenceWords.push(word);
                    }
                });
                userAnswer = tempFullUserSentenceWords.join(' ');
                
                // ê° ë¸”ë­í¬ ë‹¨ì–´ë³„ë¡œ ì •ë‹µ í™•ì¸
                inputElements.forEach(input => {
                    const index = parseInt(input.dataset.index);
                    // êµ¬ë‘ì  ì œê±° í›„ ë¹„êµ (ë‹¨ì–´ ìì²´ì˜ ë§ì¶¤ë²•ë§Œ í™•ì¸)
                    const cleanUserWord = input.value.trim().replace(/['".,!?;:/-]$/, '');
                    const cleanCorrectWord = originalWords[index].replace(/['".,!?;:/-]$/, '');

                    if (cleanUserWord.toLowerCase() !== cleanCorrectWord.toLowerCase()) {
                        isCorrect = false;
                        input.style.borderColor = 'red'; // í‹€ë¦° ë¸”ë­í¬ëŠ” ë¹¨ê°„ í…Œë‘ë¦¬
                    } else {
                        input.style.borderColor = 'green'; // ë§ì€ ë¸”ë­í¬ëŠ” ì´ˆë¡ í…Œë‘ë¦¬
                    }
                });
            }
            
            if (isCorrect) {
                feedbackDiv.textContent = 'ğŸ‘ ì •ë‹µì´ì—ìš”! 10ì  íšë“!';
                feedbackDiv.classList.remove('wrong');
                feedbackDiv.classList.add('correct');
                totalScore += 10;
                totalScoreSpan.textContent = totalScore;
                // ëª¨ë“  ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
                document.querySelectorAll('.blank-input').forEach(input => input.disabled = true);
                if (currentRound === 3 || currentRound === 4) fullSentenceInput.disabled = true;
            } else {
                feedbackDiv.textContent = 'âŒ í‹€ë ¸ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ì„¸ìš”.';
                feedbackDiv.classList.remove('correct');
                feedbackDiv.classList.add('wrong');
                correctAnswerReveal.classList.remove('hidden');
                revealedAnswerSpan.innerHTML = formatAnswerWithDifferences(userAnswer, correctAnswer);
                // ì…ë ¥ í•„ë“œëŠ” ê·¸ëŒ€ë¡œ ë‘ê³  ë‹¤ì‹œ ì‹œë„í•  ìˆ˜ ìˆë„ë¡
                if (currentRound === 3 || currentRound === 4) fullSentenceInput.disabled = false;
            }
        }

        // ì •ë‹µê³¼ ì‚¬ìš©ì ì…ë ¥ì˜ ì°¨ì´ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
        function formatAnswerWithDifferences(user, correct) {
            // ë‹¨ì–´ì™€ êµ¬ë‘ì ì„ ë…ë¦½ì ì¸ í† í°ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” í•¨ìˆ˜
            // í•˜ì´í”ˆ, ì•„í¬ìŠ¤íŠ¸ë¡œí”¼ ë“±ë„ ë‹¨ì–´ì˜ ì¼ë¶€ë¡œ ì¸ì‹í•˜ë„ë¡ ì •ê·œì‹ ìˆ˜ì •
            const tokenize = (text) => text.match(/\b[\w'-]+\b|[.,!?;:\"'\/]/g) || [];
            
            const userTokens = tokenize(user);
            const correctTokens = tokenize(correct);

            let resultHtml = '';
            let correctTokenIndex = 0; // ì •ë‹µ í† í° ë°°ì—´ì˜ í˜„ì¬ ì¸ë±ìŠ¤

            for (let i = 0; i < userTokens.length; i++) {
                const userToken = userTokens[i];
                let userWordClean = userToken.toLowerCase().replace(/['".,!?;:/-]$/, ''); 

                let foundMatch = false;

                // ì •ë‹µ í† í° ì¤‘ì—ì„œ ì¼ì¹˜í•˜ëŠ” ê²ƒì„ ì°¾ìŒ
                if (correctTokenIndex < correctTokens.length) {
                    const correctToken = correctTokens[correctTokenIndex];
                    let correctWordClean = correctToken.toLowerCase().replace(/['".,!?;:/-]$/, ''); 

                    if (userWordClean === correctWordClean) { // ë‹¨ì–´ ë‚´ìš©ì´ ê°™ì„ ë•Œ (êµ¬ë‘ì  ë¬´ì‹œ)
                        if (userToken === correctToken) { // êµ¬ë‘ì ê¹Œì§€ ì™„ì „íˆ ê°™ìœ¼ë©´
                            resultHtml += `<span class="correct-word">${userToken}</span> `;
                        } else { // ë‹¨ì–´ëŠ” ê°™ì§€ë§Œ êµ¬ë‘ì ì´ ë‹¤ë¥´ë©´
                            resultHtml += `<span class="correct-word">${userToken}</span> (<span class="missing-word">${correctToken}</span>) `;
                        }
                        correctTokenIndex++;
                        foundMatch = true;
                    } else if (userToken.match(/^[.,!?;:\"'/]$/) && userToken === correctToken) { // ì‚¬ìš©ì ì…ë ¥ì´ êµ¬ë‘ì ì´ê³ , ì •ë‹µë„ ë™ì¼ êµ¬ë‘ì 
                            resultHtml += `<span class="correct-word">${userToken}</span> `;
                            correctTokenIndex++;
                            foundMatch = true;
                    } else { // ë¶ˆì¼ì¹˜í•˜ëŠ” ê²½ìš°
                        // ì‚¬ìš©ìê°€ í‹€ë¦° ë‹¨ì–´ (ì •ë‹µ ë‹¨ì–´ì™€ ë¹„êµ)
                        resultHtml += `<span class="wrong-word">${userToken}</span> `;
                        // ë§Œì•½ ì •ë‹µ í† í°ì´ ë‚¨ì•„ìˆê³ , ì´ ì •ë‹µ í† í°ì´ ì‚¬ìš©ì í† í° ë‹¤ìŒì— ë‚˜ì™€ì•¼ í•  êµ¬ë‘ì ì´ë¼ë©´, ë¨¼ì € ì²˜ë¦¬
                        if (correctToken.match(/^[.,!?;:\"'/]$/)) { // ì •ë‹µì´ êµ¬ë‘ì ì¸ ê²½ìš°
                             resultHtml += `<span class="missing-word">[${correctToken}]</span> `;
                             correctTokenIndex++;
                        } else { // ì •ë‹µì´ ë‹¨ì–´ì¸ ê²½ìš°
                            resultHtml += `(<span class="missing-word">${correctToken}</span>) `;
                            correctTokenIndex++;
                        }
                        foundMatch = true; // ì‚¬ìš©ì í† í°ì€ ì²˜ë¦¬ë¨
                    }
                } 
                
                if (!foundMatch) { // ì‚¬ìš©ì ì…ë ¥ì—ë§Œ ìˆëŠ” ë‹¨ì–´ (ì¶”ê°€ëœ ë‹¨ì–´)
                     resultHtml += `<span class="extra-word">${userToken}</span> `;
                }
            }

            // ì •ë‹µ í† í° ì¤‘ì—ì„œ ì‚¬ìš©ì ì…ë ¥ì— ì—†ëŠ” ë‹¨ì–´ (ë¹¼ë¨¹ì€ ë‹¨ì–´)
            while (correctTokenIndex < correctTokens.length) {
                resultHtml += `<span class="missing-word">[${correctTokens[correctTokenIndex]}]</span> `;
                correctTokenIndex++;
            }
            
            return resultHtml.trim();
        }


        function nextQuestion() {
            currentSentenceIndex++;
            if (currentSentenceIndex < sentences.length) {
                displayQuestion();
            } else {
                // í˜„ì¬ ë¼ìš´ë“œì˜ ëª¨ë“  ë¬¸ì œ ì™„ë£Œ
                currentSentenceIndex = 0; // ë‹¤ìŒ ë¼ìš´ë“œë¥¼ ìœ„í•´ ì¸ë±ìŠ¤ ì´ˆê¸°í™”
                currentRound++; // ë‹¤ìŒ ë¼ìš´ë“œë¡œ ì´ë™
                if (currentRound <= maxRounds) {
                    // ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘
                    displayQuestion();
                } else {
                    // ëª¨ë“  ë¼ìš´ë“œ ì¢…ë£Œ
                    endGame();
                }
            }
        }

        function prevQuestion() {
            // ì²« ë²ˆì§¸ ë¬¸ì œì˜ ì²« ë¼ìš´ë“œì—ì„œëŠ” ë” ì´ìƒ ë’¤ë¡œ ê°ˆ ìˆ˜ ì—†ìŒ
            if (currentRound === 1 && currentSentenceIndex === 0) {
                return;
            }

            if (currentSentenceIndex > 0) {
                currentSentenceIndex--;
            } else if (currentRound > 1) {
                currentRound--;
                currentSentenceIndex = sentences.length - 1; // ì´ì „ ë¼ìš´ë“œì˜ ë§ˆì§€ë§‰ ë¬¸ì œë¡œ ì´ë™
            }
            displayQuestion();
        }

        function goToRound(roundNum) {
            if (roundNum >= 1 && roundNum <= maxRounds) {
                currentRound = roundNum;
                currentSentenceIndex = 0; // í•´ë‹¹ ë¼ìš´ë“œì˜ ì²« ë¬¸ì œë¡œ ì´ë™
                totalScore = 0; // ë¼ìš´ë“œ ë³€ê²½ ì‹œ ì ìˆ˜ ì´ˆê¸°í™”
                totalScoreSpan.textContent = 0;
                displayQuestion();
            }
        }

        function endGame() {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            finalScoreSpan.textContent = totalScore;
        }

        function restartGame() {
            currentSentenceIndex = 0;
            totalScore = 0;
            currentRound = 1;
            totalScoreSpan.textContent = 0;
            gameScreen.classList.remove('hidden');
            endScreen.classList.add('hidden');
            displayQuestion();
        }

        // ê²Œì„ ì‹œì‘ ì‹œ ì²« ë¬¸ì œ í‘œì‹œ
        displayQuestion();
    </script>
</body>
</html>